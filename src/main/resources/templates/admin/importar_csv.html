<html th:replace="~{layout/base_admin :: html}">


  <div th:fragment="contenido" class="d-flex flex-column min-vh-100">

    <div class="container my-5 flex-grow-1">
      <section class="text-center mb-4">
        <h1 class="display-5">Importar Hechos desde CSV</h1>
        <p class="text-muted">Carga archivos CSV con hechos. El archivo puede contener más de 10.000 entradas.</p>
      </section>

      <section class="row justify-content-center">
        <div class="col-md-8">
          <form id="formImportar" class="border p-4 rounded shadow-sm bg-light" th:action="@{/importar_csv}" method="post" enctype="multipart/form-data">
              <div class="mb-3">
                  <label for="archivoCSV" class="form-label">Seleccionar archivo CSV</label>
                  <input type="file" class="form-control" id="archivoCSV" name="archivo" accept=".csv" required>
              </div>
            <div class="mb-3" id="infoArchivo" style="display:none;">
              <p>Archivo seleccionado: <span id="nombreArchivo"></span> (<span id="tamanoArchivo"></span>)</p>
            </div>
            <button type="submit" class="btn btn-primary w-100">Importar</button>
          </form>

            <!-- Overlay de carga -->
            <div id="overlayCarga"
                 class="position-fixed top-0 start-0 w-100 h-100 align-items-center justify-content-center"
                 style="background: rgba(0,0,0,0.5); z-index: 2000; display: none;">
                <div class="text-center text-white">
                    <div class="spinner-border text-light mb-3" role="status"></div>
                    <p class="fs-5">Importando archivo…<br>Esto puede tardar unos minutos</p>
                </div>
            </div>



            <!-- Modal de Bootstrap -->
            <div class="modal fade" id="modalCarga" tabindex="-1" aria-labelledby="modalCargaLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="modalCargaLabel">Resultado de la importación</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                        </div>
                        <div class="modal-body" id="mensajeModal">
                            <!-- Aquí se mostrará la respuesta del backend -->
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-primary" id="btnAceptarModal">
                                Aceptar
                            </button>

                        </div>
                    </div>
                </div>
            </div>


        </div>
      </section>
    </div>
      <script>
          document.getElementById("btnAceptarModal").addEventListener("click", () => {
              window.location.reload();
          });
      </script>

      <script th:src="@{/js/importar_csv.js}"></script>

  </div>
</html>
